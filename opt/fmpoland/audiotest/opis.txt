To use this audio test you must have
installed local web server, e.g. apache2 and php.


Below is a description of how to perform a local measurement test of the level of our audio output to the SVXReflector network.
For this purpose, the ALSA Loop virtual carat will be used
audio from svxlink will be able to be recorded via such a virtual card and listened to on a special page in the dashboard where we will see the audio level indicator on the dB scale.

===========================================================


Loading the ALSA Loopback Virtual Sound Card:
====================================================

Add to file /etc/modules

  snd_aloop

Add the lines to the beginning of the file in /etc/modprobe.d/alsa.conf

  options snd_aloop index=1


Reboot your pi.

You can check if the card is visible with the command Loopback:

cat /proc/asound/cards

It will be visible in the Loopback directory under the number:

 0 [USB-Sound-Card    ]: USB-Sound-Card - USB Audio
                      CM108/CM119 Sound Card
 1 [Loopback       ]: Loopback - Loopback
                      Loopback 1


Copy the SimplexLogicTS.tcl file to /usr/share/svxlink/events.d/


Make copies of your svxlink.conf 

cp /etc/svxlink/svxlink.conf /etc/svxlink/svxlink-copy.conf


Make changes in /etc/svxlink/svxlink.conf
========================================= 

Add it to SimplexLogicTS 

in [GLOBAL] as below line:

LOGICS=SimplexLogic,ReflectorLogic,SimplexLogicTS

and in [ReflectorLink] make the following line:

CONNECT_LOGICS=SimplexLogic:9:SVX,ReflectorLogic,SimplexLogicTS

==========================================

Now restart svxlink

sudo systemctl restart svxlink


You can now record your audio:
===========================================

Open the page on your dashboard:

http://ip_address/audio/

Select the test group, e.g. TG999, using DTMF
code: 91999#

Click the "Click to record 15 sec test audio" button

Speak into the microphone as if you were making a call

The maximum recording time is 15 seconds.

Once the recording is finished, the dashboard page will refresh
(the color indicator of the level meter will appear momentarily)
and under the meter you will see the name of the recorded file which
will have the exact last date and time of recording in its name.

You can now listen to the recorded audio by clicking the button
player under the name of the audio file.


Look at the indicator on the page, the audio should be set correctly
between -15 and 10dB and only single peaks may appear at -10dB.

If the recorded audio does not show the recommended levels, run the alsamixer program and change the microphone input gain settings and
do the audio recording procedure again. Repeat this until you get it
recommended audio settings.


==========================


You can also manually record audio with the command: /opt/fmpoland/audiotest/audio.sh

speak into the microphone as if you were making a call

Recording time maximum 10 seconds.

After finishing recording, use CTRL+C

you will be able to listen to your recording on the dashboard page

http://ip_address/audio

